<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>学习笔记索引</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg: #f7f7f5;
    --surface: #ffffff;
    --surface-muted: #fafaf9;
    --text: #171717;
    --text-secondary: #575757;
    --line: #e5e5e3;
    --accent: #111111;
    --accent-soft: rgba(17, 17, 17, 0.06);
    --shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
}

:root[data-theme="dark"] {
    --bg: #111111;
    --surface: #171717;
    --surface-muted: #1d1d1d;
    --text: #ededed;
    --text-secondary: #a8a8a8;
    --line: #2c2c2c;
    --accent: #f3f3f3;
    --accent-soft: rgba(243, 243, 243, 0.08);
    --shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
}

* {
    box-sizing: border-box;
}

html,
body {
    margin: 0;
    min-height: 100%;
}

body {
    font-family: "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
}

a {
    color: inherit;
    text-decoration: none;
}

.topbar {
    position: sticky;
    top: 0;
    z-index: 40;
    border-bottom: 1px solid var(--line);
    background: var(--bg);
    backdrop-filter: blur(6px);
}

.topbar-inner {
    height: 58px;
    max-width: 1320px;
    margin: 0 auto;
    padding: 0 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.brand {
    font-size: 1.3rem;
    font-weight: 700;
    letter-spacing: -0.01em;
}

.topnav {
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.topnav-link,
.topbar-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 34px;
    padding: 0 0.9rem;
    border: 1px solid transparent;
    border-radius: 9px;
    font-size: 0.86rem;
    color: var(--text-secondary);
    background: transparent;
    cursor: pointer;
    transition: all 0.2s ease;
}

.topnav-link:hover,
.topbar-button:hover {
    border-color: var(--line);
    background: var(--surface);
    color: var(--text);
}

.topnav-link.active {
    border-color: var(--line);
    background: var(--surface);
    color: var(--text);
}

.page {
    max-width: 1320px;
    margin: 0 auto;
    padding: 1.2rem 1rem 2rem;
}

.layout {
    display: grid;
    grid-template-columns: 250px minmax(0, 1fr) 230px;
    gap: 1rem;
    align-items: start;
}

.panel {
    background: var(--surface);
    border: 1px solid var(--line);
    border-radius: 12px;
    box-shadow: var(--shadow);
}

.sidebar {
    position: sticky;
    top: 76px;
    padding: 0.95rem;
}

.panel-title {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
}

.search-wrap {
    margin-top: 0.75rem;
}

.search-input {
    width: 100%;
    height: 38px;
    border: 1px solid var(--line);
    border-radius: 9px;
    padding: 0 0.8rem;
    font-size: 0.9rem;
    color: var(--text);
    background: var(--surface-muted);
}

.search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--accent-soft);
    background: var(--surface);
}

.shortcut-hint {
    margin: 0.45rem 0 0;
    font-size: 0.74rem;
    color: var(--text-secondary);
}

kbd {
    font-family: inherit;
    font-size: 0.7rem;
    border: 1px solid var(--line);
    border-bottom-width: 2px;
    border-radius: 5px;
    padding: 0.05rem 0.32rem;
    background: var(--surface-muted);
}

.category-list {
    list-style: none;
    margin: 0.85rem 0 0;
    padding: 0;
    border-top: 1px solid var(--line);
}

.category-item {
    margin-top: 0.55rem;
}

.category-button {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.8rem;
    border: 1px solid transparent;
    background: transparent;
    border-radius: 9px;
    padding: 0.5rem 0.58rem;
    font-size: 0.86rem;
    color: var(--text-secondary);
    cursor: pointer;
    text-align: left;
}

.category-button:hover {
    border-color: var(--line);
    background: var(--surface-muted);
    color: var(--text);
}

.category-button.active {
    border-color: var(--line);
    background: var(--accent-soft);
    color: var(--text);
    font-weight: 600;
}

.category-count {
    color: var(--text-secondary);
    font-size: 0.8rem;
}

.sidebar-footnote {
    margin-top: 0.8rem;
    border-top: 1px solid var(--line);
    padding-top: 0.8rem;
    font-size: 0.74rem;
    color: var(--text-secondary);
}

.main-column {
    min-width: 0;
}

.doc-header {
    padding: 1.2rem 1.2rem 1.05rem;
}

.doc-title {
    margin: 0;
    font-size: clamp(1.7rem, 2.1vw, 2.2rem);
    letter-spacing: -0.02em;
    line-height: 1.25;
}

.doc-description {
    margin: 0.55rem 0 0;
    max-width: 62ch;
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.doc-meta {
    margin-top: 0.9rem;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.4rem 0.6rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.dot {
    color: var(--line);
}

.notes-panel {
    margin-top: 1rem;
    padding: 0.75rem 1rem 1rem;
}

.notes-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.4rem 0.25rem 0.6rem;
    border-bottom: 1px solid var(--line);
}

.notes-heading {
    margin: 0;
    font-size: 1.05rem;
}

.notes-count {
    font-size: 0.82rem;
    color: var(--text-secondary);
}

.group-list {
    margin-top: 0.4rem;
}

.note-group {
    scroll-margin-top: 82px;
}

.group-title {
    margin: 1rem 0 0.45rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
}

.note-row {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto auto auto;
    align-items: center;
    gap: 0.8rem;
    padding: 0.62rem 0.22rem;
    border-top: 1px solid var(--line);
}

.note-title-link {
    font-size: 0.92rem;
    font-weight: 500;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.note-title-link:hover {
    text-decoration: underline;
    text-underline-offset: 2px;
}

.note-tag {
    font-size: 0.76rem;
    color: var(--text-secondary);
    border: 1px solid var(--line);
    border-radius: 999px;
    padding: 0.13rem 0.5rem;
    white-space: nowrap;
}

.note-time {
    font-size: 0.78rem;
    color: var(--text-secondary);
    white-space: nowrap;
}

.note-open {
    font-size: 0.78rem;
    border: 1px solid var(--line);
    border-radius: 7px;
    padding: 0.24rem 0.55rem;
    color: var(--text-secondary);
    white-space: nowrap;
}

.note-open:hover {
    background: var(--surface-muted);
    color: var(--text);
}

.empty-state {
    margin-top: 0.8rem;
    border: 1px dashed var(--line);
    border-radius: 10px;
    padding: 1.3rem 0.85rem;
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.86rem;
}

.right-rail {
    position: sticky;
    top: 76px;
    padding: 0.92rem;
}

.rail-block + .rail-block {
    margin-top: 1rem;
    border-top: 1px solid var(--line);
    padding-top: 0.9rem;
}

.rail-list {
    list-style: none;
    margin: 0.6rem 0 0;
    padding: 0;
}

.rail-item + .rail-item {
    margin-top: 0.45rem;
}

.rail-link {
    font-size: 0.82rem;
    color: var(--text-secondary);
}

.rail-link:hover {
    color: var(--text);
    text-decoration: underline;
    text-underline-offset: 2px;
}

@media (max-width: 1140px) {
    .layout {
        grid-template-columns: 250px minmax(0, 1fr);
    }

    .right-rail {
        display: none;
    }
}

@media (max-width: 820px) {
    .topbar-inner {
        height: auto;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        align-items: flex-start;
        flex-direction: column;
    }

    .page {
        padding-top: 0.85rem;
    }

    .layout {
        grid-template-columns: 1fr;
    }

    .sidebar,
    .right-rail {
        position: static;
    }

    .sidebar {
        order: 1;
    }

    .main-column {
        order: 2;
    }

    .note-row {
        grid-template-columns: 1fr;
        gap: 0.35rem;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }

    .note-title-link {
        white-space: normal;
    }

    .note-tag,
    .note-time,
    .note-open {
        justify-self: start;
    }
}
</style>
</head>
<body>
<header class="topbar">
    <div class="topbar-inner">
        <div class="brand">Ningna的学习笔记</div>
        <nav class="topnav" aria-label="站点导航">
            <a class="topnav-link active" href="#">主页</a>
            <a class="topnav-link" href="#notesRoot">文档</a>
        </nav>
        <div class="topnav">
            <a class="topnav-link" href="https://github.com/ningna01/ningna01.github.io" target="_blank" rel="noopener noreferrer">GitHub</a>
            <button class="topbar-button" id="themeToggle" type="button" aria-label="切换明暗模式">深色模式</button>
        </div>
    </div>
</header>

<div class="page">
    <div class="layout">
        <aside class="panel sidebar">
            <h2 class="panel-title">文档目录</h2>
            <div class="search-wrap">
                <input class="search-input" id="searchInput" type="search" placeholder="搜索标题、分类、文件名" aria-label="搜索笔记">
                <p class="shortcut-hint">快捷键：按 <kbd>/</kbd> 聚焦搜索，<kbd>Esc</kbd> 清空。</p>
            </div>
            <ul class="category-list" id="categoryList"></ul>
            <div class="sidebar-footnote" id="dataStatus">正在加载索引数据...</div>
        </aside>

        <main class="main-column" id="notesRoot">
            <section class="panel doc-header">
                <h1 class="doc-title">学习笔记总览</h1>
                <p class="doc-description">这是一个面向阅读的文档主页，不定期进行更新。</p>
                <div class="doc-meta">
                    <span id="metaTotal">共 0 篇</span>
                    <span class="dot">•</span>
                    <span id="metaCategory">0 个分类</span>
                    <span class="dot">•</span>
                    <span id="metaLatest">最近更新 --</span>
                </div>
            </section>

            <section class="panel notes-panel">
                <div class="notes-toolbar">
                    <h2 class="notes-heading" id="notesHeading">全部笔记</h2>
                    <span class="notes-count" id="notesCount">0 条结果</span>
                </div>
                <div class="group-list" id="groupList"></div>
                <div class="empty-state" id="emptyState" hidden>没有匹配结果，请更换关键词或分类。</div>
            </section>
        </main>

        <aside class="panel right-rail">
            <section class="rail-block">
                <h2 class="panel-title">本页导航</h2>
                <ul class="rail-list" id="tocList"></ul>
            </section>
            <section class="rail-block">
                <h2 class="panel-title">最近更新</h2>
                <ul class="rail-list" id="recentList"></ul>
            </section>
        </aside>
    </div>
</div>

<script>
(function () {
    'use strict';

    const FALLBACK_INDEX = {
        generatedAt: '内置索引',
        total: 12,
        categories: [
            { key: 'all', name: '全部', count: 12 },
            { key: 'timeseries', name: '时间序列', count: 10 },
            { key: 'diffusion', name: '扩散模型', count: 2 }
        ],
        notes: [
            { id: 'timeseries-chaper12', title: '第12章', fileName: 'Chaper12.html', path: 'TimeSeries/Chaper12.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-15', updatedAtTs: 1771141759 },
            { id: 'timeseries-chapter11', title: '第11章', fileName: 'Chapter11.html', path: 'TimeSeries/Chapter11.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-05', updatedAtTs: 1770285032 },
            { id: 'diffusion-diffusion-1', title: 'Diffusion 1', fileName: 'Diffusion-1.html', path: 'Diffusion/Diffusion-1.html', category: 'diffusion', categoryName: '扩散模型', updatedAt: '2026-02-03', updatedAtTs: 1770123536 },
            { id: 'diffusion-vae', title: '变分自编码器VAE', fileName: '变分自编码器VAE.html', path: 'Diffusion/变分自编码器VAE.html', category: 'diffusion', categoryName: '扩散模型', updatedAt: '2026-02-03', updatedAtTs: 1770122779 },
            { id: 'timeseries-chapter9', title: '第9章', fileName: 'Chapter9.html', path: 'TimeSeries/Chapter9.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769973437 },
            { id: 'timeseries-chapter8', title: '第8章', fileName: 'Chapter8.html', path: 'TimeSeries/Chapter8.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769973433 },
            { id: 'timeseries-chapter7', title: '第7章', fileName: 'Chapter7.html', path: 'TimeSeries/Chapter7.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769973428 },
            { id: 'timeseries-chapter6', title: '第6章', fileName: 'Chapter6.html', path: 'TimeSeries/Chapter6.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769973144 },
            { id: 'timeseries-chapter5', title: '第5章', fileName: 'Chapter5.html', path: 'TimeSeries/Chapter5.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769972409 },
            { id: 'timeseries-chapter3', title: '第3章', fileName: 'Chapter3.html', path: 'TimeSeries/Chapter3.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769972176 },
            { id: 'timeseries-chapter1', title: '第1章', fileName: 'Chapter1.html', path: 'TimeSeries/Chapter1.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769971641 },
            { id: 'timeseries-chapter10', title: '第10章', fileName: 'Chapter10.html', path: 'TimeSeries/Chapter10.html', category: 'timeseries', categoryName: '时间序列', updatedAt: '2026-02-01', updatedAtTs: 1769971091 }
        ]
    };

    const state = {
        activeCategory: 'all',
        keyword: '',
        categories: [],
        notes: []
    };

    const categoryList = document.getElementById('categoryList');
    const searchInput = document.getElementById('searchInput');
    const dataStatus = document.getElementById('dataStatus');
    const metaTotal = document.getElementById('metaTotal');
    const metaCategory = document.getElementById('metaCategory');
    const metaLatest = document.getElementById('metaLatest');
    const notesHeading = document.getElementById('notesHeading');
    const notesCount = document.getElementById('notesCount');
    const groupList = document.getElementById('groupList');
    const emptyState = document.getElementById('emptyState');
    const tocList = document.getElementById('tocList');
    const recentList = document.getElementById('recentList');
    const themeToggle = document.getElementById('themeToggle');

    function escapeHtml(value) {
        return String(value)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
    }

    function safeUrl(path) {
        return './' + encodeURI(String(path)).replace(/#/g, '%23');
    }

    function normalizeDate(text) {
        return String(text || '--').replace(/-/g, '.');
    }

    function categoryNameOf(key) {
        const found = state.categories.find((item) => item.key === key);
        return found ? found.name : key;
    }

    function chapterNumberOf(note) {
        const sources = [note.fileName, note.path, note.title];
        for (const source of sources) {
            const text = String(source || '');
            let match = text.match(/chap(?:ter|er)(\d+)/i);
            if (match) {
                return Number(match[1]);
            }
            match = text.match(/第\s*(\d+)\s*章/);
            if (match) {
                return Number(match[1]);
            }
        }
        return null;
    }

    function sortByChapterDescending(notes) {
        return notes.slice().sort((a, b) => {
            const aNum = chapterNumberOf(a);
            const bNum = chapterNumberOf(b);

            if (aNum != null && bNum != null) {
                return bNum - aNum;
            }
            if (aNum != null) {
                return -1;
            }
            if (bNum != null) {
                return 1;
            }
            return String(a.title).localeCompare(String(b.title), 'zh-Hans-CN');
        });
    }

    function sortByUpdatedDesc(notes) {
        return notes.slice().sort((a, b) => {
            const timeDelta = (b.updatedAtTs || 0) - (a.updatedAtTs || 0);
            if (timeDelta !== 0) {
                return timeDelta;
            }
            return String(a.title).localeCompare(String(b.title), 'zh-Hans-CN');
        });
    }

    function hasChapterNotes(notes) {
        return notes.some((note) => chapterNumberOf(note) != null);
    }

    function sortNotesForCategory(categoryKey, notes) {
        if (!notes.length) {
            return [];
        }

        const newest = sortByUpdatedDesc(notes)[0];
        const rest = notes.filter((note) => note.id !== newest.id);
        const sortedRest = hasChapterNotes(rest)
            ? sortByChapterDescending(rest)
            : sortByUpdatedDesc(rest);
        return [newest].concat(sortedRest);
    }

    function renderMeta() {
        const total = state.notes.length;
        const categories = state.categories.filter((item) => item.key !== 'all').length;
        const latest = total ? normalizeDate(state.notes[0].updatedAt) : '--';

        metaTotal.textContent = '共 ' + total + ' 篇';
        metaCategory.textContent = categories + ' 个分类';
        metaLatest.textContent = '最近更新 ' + latest;
    }

    function filteredNotes() {
        const keyword = state.keyword.trim().toLowerCase();

        return state.notes.filter((note) => {
            const categoryMatch = state.activeCategory === 'all' || note.category === state.activeCategory;
            if (!categoryMatch) {
                return false;
            }

            if (!keyword) {
                return true;
            }

            const text = [note.title, note.fileName, note.path, note.categoryName].join(' ').toLowerCase();
            return text.includes(keyword);
        });
    }

    function groupedByCategory(notes) {
        if (state.activeCategory !== 'all') {
            return [{
                key: state.activeCategory,
                name: categoryNameOf(state.activeCategory),
                notes: sortNotesForCategory(state.activeCategory, notes)
            }];
        }

        const groups = [];
        const byKey = new Map();

        notes.forEach((note) => {
            const key = note.category;
            if (!byKey.has(key)) {
                byKey.set(key, []);
            }
            byKey.get(key).push(note);
        });

        state.categories.forEach((category) => {
            if (category.key === 'all') {
                return;
            }
            const groupNotes = byKey.get(category.key) || [];
            if (groupNotes.length) {
                groups.push({
                    key: category.key,
                    name: category.name,
                    notes: sortNotesForCategory(category.key, groupNotes)
                });
            }
        });

        return groups;
    }

    function renderCategoryList() {
        categoryList.innerHTML = state.categories.map((category) => {
            const activeClass = category.key === state.activeCategory ? 'category-button active' : 'category-button';
            return '<li class="category-item">' +
                '<button type="button" class="' + activeClass + '" data-category="' + escapeHtml(category.key) + '">' +
                '<span>' + escapeHtml(category.name) + '</span>' +
                '<span class="category-count">' + category.count + '</span>' +
                '</button>' +
                '</li>';
        }).join('');

        categoryList.querySelectorAll('.category-button').forEach((button) => {
            button.addEventListener('click', () => {
                state.activeCategory = button.dataset.category || 'all';
                renderCategoryList();
                renderGroups();
            });
        });
    }

    function renderGroups() {
        const notes = filteredNotes();
        const groups = groupedByCategory(notes);

        notesHeading.textContent = state.activeCategory === 'all'
            ? '全部笔记'
            : (categoryNameOf(state.activeCategory) + ' 笔记');
        notesCount.textContent = notes.length + ' 条结果';

        if (!notes.length) {
            groupList.innerHTML = '';
            tocList.innerHTML = '';
            emptyState.hidden = false;
            return;
        }

        emptyState.hidden = true;

        groupList.innerHTML = groups.map((group) => {
            return '<section class="note-group" id="group-' + escapeHtml(group.key) + '">' +
                '<h3 class="group-title">' + escapeHtml(group.name) + ' (' + group.notes.length + ')</h3>' +
                group.notes.map((note) => {
                    return '<article class="note-row">' +
                        '<a class="note-title-link" href="' + escapeHtml(safeUrl(note.path)) + '" target="_blank" rel="noopener noreferrer" title="' + escapeHtml(note.title) + '">' + escapeHtml(note.title) + '</a>' +
                        '<span class="note-tag">' + escapeHtml(note.categoryName) + '</span>' +
                        '<time class="note-time" datetime="' + escapeHtml(note.updatedAt) + '">' + escapeHtml(normalizeDate(note.updatedAt)) + '</time>' +
                        '<a class="note-open" href="' + escapeHtml(safeUrl(note.path)) + '" target="_blank" rel="noopener noreferrer">新标签页打开</a>' +
                        '</article>';
                }).join('') +
                '</section>';
        }).join('');

        tocList.innerHTML = groups.map((group) => {
            return '<li class="rail-item"><a class="rail-link" href="#group-' + escapeHtml(group.key) + '">' + escapeHtml(group.name) + '</a></li>';
        }).join('');
    }

    function renderRecent() {
        const recent = state.notes.slice(0, 5);
        recentList.innerHTML = recent.map((note) => {
            return '<li class="rail-item"><a class="rail-link" href="' + escapeHtml(safeUrl(note.path)) + '" target="_blank" rel="noopener noreferrer">' + escapeHtml(note.title) + '</a></li>';
        }).join('');
    }

    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        themeToggle.textContent = theme === 'dark' ? '浅色模式' : '深色模式';
    }

    function initTheme() {
        const saved = localStorage.getItem('blog-theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = saved || (prefersDark ? 'dark' : 'light');
        applyTheme(theme);

        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme') || 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
            localStorage.setItem('blog-theme', next);
        });
    }

    async function loadIndex() {
        try {
            const response = await fetch('./data/notes.json', { cache: 'no-store' });
            if (!response.ok) {
                throw new Error('failed to fetch notes index');
            }
            const payload = await response.json();
            if (!payload || !Array.isArray(payload.notes) || !Array.isArray(payload.categories)) {
                throw new Error('invalid notes index payload');
            }
            return payload;
        } catch (error) {
            return FALLBACK_INDEX;
        }
    }

    function bindSearchShortcuts() {
        searchInput.addEventListener('input', () => {
            state.keyword = searchInput.value;
            renderGroups();
        });

        document.addEventListener('keydown', (event) => {
            const target = event.target;
            const isTyping = target && (
                target.tagName === 'INPUT' ||
                target.tagName === 'TEXTAREA' ||
                target.isContentEditable
            );

            if (event.key === '/' && !isTyping) {
                event.preventDefault();
                searchInput.focus();
                searchInput.select();
            }

            if (event.key === 'Escape' && document.activeElement === searchInput && searchInput.value) {
                searchInput.value = '';
                state.keyword = '';
                renderGroups();
            }
        });
    }

    async function init() {
        initTheme();

        const payload = await loadIndex();
        state.notes = payload.notes.slice().sort((a, b) => (b.updatedAtTs || 0) - (a.updatedAtTs || 0));
        state.categories = payload.categories;

        renderMeta();
        renderCategoryList();
        renderGroups();
        renderRecent();

        const generatedAt = payload.generatedAt ? String(payload.generatedAt) : '--';
        dataStatus.textContent = '索引更新时间：' + generatedAt;

        bindSearchShortcuts();
    }

    init();
})();
</script>
</body>
</html>
